<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Fruit Prediction</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"  crossorigin="anonymous">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Fruit Prediction</h1>
        <form class="predict-form d-flex flex-column align-items-center" method="post" action="{% url 'predict' %}" enctype="multipart/form-data" id="predict-form">
            {% csrf_token %}
            <div class="mb-3">
                <input type="file" name="image" accept="image/*" class="form-control" id="image-input" onchange="previewImage()">
            </div>
            <div class="mb-3">
                <img id="image-preview" src="" alt="Preview" style="max-width: 300px; max-height: 300px;">
            </div>
            <button type="submit" class="btn btn-primary" id="predict-btn">Predict</button>
        </form>

        <script>
            function previewImage() {
                const imageInput = document.getElementById('image-input');
                const imagePreview = document.getElementById('image-preview');
                imagePreview.src = URL.createObjectURL(imageInput.files[0]);
            }
        </script>

        <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script>
        <script>
    $(document).ready(function(){
        $('#predict-btn').click(function(e){
            e.preventDefault();
            var formData = new FormData($('#predict-form')[0]);

            $.ajax({
                url: '{% url "predict" %}',
                type: 'POST',
                data: formData,
                contentType: false,
                cache: false,
                processData: false,
                success: function(response){
                    // Clear previous results
                    $('#results').remove();

                    // Create results container
                    var resultsContainer = $('<div id="results" class="mt-5 text-center"></div>');
                    resultsContainer.append('<h2>Predictions:</h2>');
                    var ul = $('<ul class="list-group mt-3"></ul>');

                    // Sort predictions by probability
                    var predictions = response.results;
                    predictions.sort(function(a, b) {
                        return parseFloat(b.probability.replace('%', '')) - parseFloat(a.probability.replace('%', ''));
                    });

                    // Add predictions
                    $.each(predictions, function(index, prediction){
                        ul.append('<li class="list-group-item">'+ prediction.class + ' ('+ prediction.probability + ')</li>');
                    });

                    resultsContainer.append(ul);

                    // Insert after form
                    $('#predict-form').after(resultsContainer);
                },
                error: function(xhr, status, error){
                    alert("Something went wrong: " + error);
                }
            });
        });
    });
</script>

    </div>
</body>
</html>

